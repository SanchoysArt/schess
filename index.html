<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Шахматы Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #111;
  color: #fff;
  font-family: system-ui;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.game {
  display: flex;
  gap: 20px;
}

.board {
  display: grid;
  grid-template-columns: repeat(8, 70px);
  grid-template-rows: repeat(8, 70px);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 0 25px black;
}

.square {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 42px;
  cursor: pointer;
  user-select: none;
}

.light { background: #f0d9b5; }
.dark { background: #b58863; }

.square.move {
  background: radial-gradient(circle, rgba(0,0,0,.4) 20%, transparent 22%);
}

.square.capture {
  background: radial-gradient(circle, rgba(255,0,0,.6) 25%, transparent 30%);
}

.square.check {
  box-shadow: inset 0 0 0 4px red;
}

.panel {
  width: 280px;
  background: #1f1f1f;
  border-radius: 12px;
  padding: 15px;
  display: flex;
  flex-direction: column;
}

.panel h2 {
  text-align: center;
  margin: 0 0 10px;
}

.status {
  text-align: center;
  margin-bottom: 8px;
}

.timer {
  display: flex;
  justify-content: space-between;
  margin-bottom: 8px;
}

.moves {
  flex: 1;
  background: #141414;
  border-radius: 6px;
  padding: 8px;
  font-size: 14px;
  overflow-y: auto;
}

button {
  margin-top: 10px;
  padding: 10px;
  border: none;
  border-radius: 8px;
  background: #4caf50;
  color: white;
  font-size: 16px;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="game">
  <div id="board" class="board"></div>

  <div class="panel">
    <h2>♟ Шахматы Pro</h2>
    <div id="status" class="status"></div>

    <div class="timer">
      <div>⏱ Белые: <span id="tw">10:00</span></div>
      <div>⏱ Чёрные: <span id="tb">10:00</span></div>
    </div>

    <div id="moves" class="moves"></div>

    <button onclick="newGame()">Новая партия</button>
  </div>
</div>

<script>
/* ====================== ДАННЫЕ ====================== */
const boardEl = document.getElementById("board");
const statusEl = document.getElementById("status");
const movesEl = document.getElementById("moves");

const PIECES = {
  r:"♜", n:"♞", b:"♝", q:"♛", k:"♚", p:"♟",
  R:"♖", N:"♘", B:"♗", Q:"♕", K:"♔", P:"♙"
};

let board, turn, selected, moves, timers, interval;
let enPassant = null;
let castling;

/* ====================== ИНИЦИАЛИЗАЦИЯ ====================== */
function newGame() {
  board = [
    "rnbqkbnr",
    "pppppppp",
    "........",
    "........",
    "........",
    "........",
    "PPPPPPPP",
    "RNBQKBNR"
  ].map(r=>r.split(""));

  turn = "white";
  selected = null;
  moves = [];
  enPassant = null;
  castling = {K:true,Q:true,k:true,q:true};

  timers = {white:600, black:600};
  clearInterval(interval);
  interval = setInterval(updateTimers,1000);

  render();
  updateStatus();
  updateMoves();
}

/* ====================== РЕНДЕР ====================== */
function render() {
  boardEl.innerHTML = "";
  for(let y=0;y<8;y++){
    for(let x=0;x<8;x++){
      const s = document.createElement("div");
      s.className = `square ${(x+y)%2?"dark":"light"}`;
      s.onclick = ()=>clickSquare(x,y);

      const p = board[y][x];
      if(p!=".") s.textContent = PIECES[p];

      boardEl.appendChild(s);
    }
  }
}

/* ====================== ЛОГИКА ====================== */
function clickSquare(x,y){
  const p = board[y][x];
  if(selected){
    if(tryMove(selected.x,selected.y,x,y)){
      selected=null;
      render();
      if(turn==="black") setTimeout(aiMove,300);
    } else selected=null;
    return;
  }
  if(p!="." && isOwn(p)){
    selected={x,y};
    showMoves(x,y);
  }
}

function isOwn(p){
  return turn==="white"?p===p.toUpperCase():p===p.toLowerCase();
}

/* ====================== ХОД ====================== */
function tryMove(x1,y1,x2,y2){
  const p = board[y1][x1];
  const target = board[y2][x2];
  if(target!="." && isOwn(target)) return false;

  // пешка
  if(p.toLowerCase()=="p"){
    const dir = p=="P"?-1:1;
    if(x1==x2 && target=="." && y2==y1+dir){}
    else if(Math.abs(x2-x1)==1 && y2==y1+dir && target!="."){}
    else return false;
  }

  board[y2][x2]=p;
  board[y1][x1]=".";

  // превращение
  if(p=="P" && y2==0) board[y2][x2]="Q";
  if(p=="p" && y2==7) board[y2][x2]="q";

  moves.push(`${p}${String.fromCharCode(97+x1)}${8-y1}-${String.fromCharCode(97+x2)}${8-y2}`);
  turn = turn==="white"?"black":"white";
  updateStatus();
  updateMoves();
  return true;
}

/* ====================== ИИ ====================== */
function aiMove(){
  let all=[];
  for(let y=0;y<8;y++)
    for(let x=0;x<8;x++)
      if(board[y][x]!="." && board[y][x]==board[y][x].toLowerCase())
        for(let ty=0;ty<8;ty++)
          for(let tx=0;tx<8;tx++)
            all.push([x,y,tx,ty]);

  while(all.length){
    const m = all.splice(Math.random()*all.length|0,1)[0];
    if(tryMove(...m)) break;
  }
  render();
}

/* ====================== UI ====================== */
function updateStatus(){
  statusEl.textContent = "Ход: " + (turn==="white"?"Белые":"Чёрные");
}

function updateMoves(){
  movesEl.innerHTML = moves.map((m,i)=>`${i+1}. ${m}`).join("<br>");
}

function updateTimers(){
  timers[turn]--;
  if(timers[turn]<=0){
    alert("Время вышло!");
    clearInterval(interval);
  }
  document.getElementById("tw").textContent = format(timers.white);
  document.getElementById("tb").textContent = format(timers.black);
}

function format(t){
  return `${Math.floor(t/60)}:${String(t%60).padStart(2,"0")}`;
}

newGame();
</script>
</body>
</html>