<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Шахматы • Fullscreen</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --dark:#050000;
  --red:#7a0000;
  --glow:rgba(255,0,0,.7);
}

*{box-sizing:border-box}

body{
  margin:0;
  height:100vh;
  background:radial-gradient(circle at top,#300,#000 70%);
  color:#fff;
  font-family:system-ui,sans-serif;
  display:flex;
  flex-direction:column;
}

#controls{
  display:flex;
  gap:10px;
  padding:8px;
  justify-content:center;
  background:#100;
  z-index:10;
}

select,button{
  background:#200;
  color:#fff;
  border:1px solid #600;
  border-radius:10px;
  padding:6px 12px;
  font-size:16px;
}

button:hover{background:#300}

#status{
  text-align:center;
  padding:6px;
  font-size:18px;
  min-height:1.4em;
}

#board{
  flex:1;
  display:grid;
  grid-template-columns:repeat(8,1fr);
  width:100vmin;
  height:100vmin;
  max-width:100vw;
  max-height:100vh;
  margin:auto;
  border-radius:16px;
  box-shadow:0 0 40px var(--glow);
  overflow:hidden;
}

.square{
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:clamp(28px,8vw,64px);
  position:relative;
  transition:background .3s;
}

.light{background:#260000}
.dark{background:#120000}

.square.highlight::after{
  content:"";
  position:absolute;
  inset:14%;
  border-radius:50%;
  background:radial-gradient(circle,var(--glow),transparent 70%);
  animation:pulse 1.2s infinite;
}

@keyframes pulse{
  0%{opacity:.3}
  50%{opacity:.9}
  100%{opacity:.3}
}

.piece{
  width:82%;
  height:82%;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(145deg,#444,#111);
  box-shadow:
    0 8px 18px rgba(0,0,0,.8),
    inset 0 0 8px rgba(255,255,255,.25),
    0 0 14px var(--glow);
  transition:transform .25s ease;
}

.square:active .piece{transform:scale(1.15)}

@media (orientation:landscape){
  #controls{position:absolute; top:0; width:100%}
}
</style>
</head>

<body>

<div id="controls">
  <select id="level">
    <option value="1">1 • Новичок</option>
    <option value="2">2</option>
    <option value="3" selected>3 • Средний</option>
    <option value="4">4</option>
    <option value="5">5 • Мастер</option>
  </select>

  <select id="side">
    <option value="w">Белые</option>
    <option value="b">Чёрные</option>
  </select>

  <button onclick="newGame()">Новая игра</button>
</div>

<div id="status"></div>
<div id="board"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stockfish.js/10.0.2/stockfish.wasm.js"></script>

<script>
const game=new Chess()
const boardEl=document.getElementById("board")
const statusEl=document.getElementById("status")

const symbols={
  p:"♟",r:"♜",n:"♞",b:"♝",q:"♛",k:"♚",
  P:"♙",R:"♖",N:"♘",B:"♗",Q:"♕",K:"♔"
}

let selected=null
let userSide="w"

const engine=new Worker("https://cdnjs.cloudflare.com/ajax/libs/stockfish.js/10.0.2/stockfish.wasm.js")
engine.postMessage("uci")

function draw(){
  boardEl.innerHTML=""
  const board=game.board()
  const flip=userSide==="b"

  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      const rr=flip?7-r:r
      const cc=flip?7-c:c
      const sq=document.createElement("div")
      sq.className="square "+((rr+cc)%2?"dark":"light")
      const pos="abcdefgh"[cc]+(8-rr)
      sq.dataset.pos=pos

      if(selected){
        const moves=game.moves({square:selected,verbose:true})
        if(moves.some(m=>m.to===pos)) sq.classList.add("highlight")
      }

      sq.onclick=()=>click(pos)

      const p=board[rr][cc]
      if(p){
        const pe=document.createElement("div")
        pe.className="piece"
        pe.textContent=symbols[p.color==="w"?p.type.toUpperCase():p.type]
        sq.appendChild(pe)
      }

      boardEl.appendChild(sq)
    }
  }
}

function click(pos){
  if(game.game_over()) return

  if(selected){
    const move=game.move({from:selected,to:pos,promotion:"q"})
    selected=null
    if(move){
      updateStatus()
      draw()
      setTimeout(aiMove,250)
    }else{
      selected=pos
      draw()
    }
  }else{
    const p=game.get(pos)
    if(p && p.color===userSide && game.turn()===userSide){
      selected=pos
      draw()
    }
  }
}

function aiMove(){
  if(game.game_over()) return
  engine.postMessage("position fen "+game.fen())
  engine.postMessage("go depth "+(document.getElementById("level").value*3+2))
}

engine.onmessage=e=>{
  if(e.data.startsWith("bestmove")){
    const m=e.data.split(" ")[1]
    if(m!=="(none)"){
      game.move({from:m.slice(0,2),to:m.slice(2,4),promotion:"q"})
      updateStatus()
      draw()
    }
  }
}

function updateStatus(){
  if(game.in_checkmate())
    statusEl.textContent=game.turn()===userSide?"Вы проиграли":"Вы победили"
  else if(game.in_draw())
    statusEl.textContent="Ничья"
  else
    statusEl.textContent=game.turn()===userSide?"Ваш ход":"Ход ИИ"
}

function newGame(){
  game.reset()
  userSide=document.getElementById("side").value
  selected=null
  statusEl.textContent=""
  draw()
  if(userSide==="b") setTimeout(aiMove,300)
}

newGame()
</script>
</body>
</html>