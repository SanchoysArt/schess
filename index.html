<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Glass Tic Tac Toe</title>

<style>
:root{
  --glass: rgba(255,255,255,.12);
}

*{box-sizing:border-box;font-family:system-ui,sans-serif}

body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(circle,#111,#000);
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
}

.app{
  width:95%;
  max-width:360px;
  background:var(--glass);
  backdrop-filter:blur(20px);
  border-radius:24px;
  padding:16px;
  border:1px solid rgba(255,255,255,.2);
}

h1{
  text-align:center;
  font-weight:300;
  letter-spacing:3px;
}

.menu{
  display:flex;
  gap:8px;
  margin:10px 0;
}

button{
  flex:1;
  padding:10px;
  background:transparent;
  border:1px solid rgba(255,255,255,.6);
  border-radius:12px;
  color:white;
  transition:.25s;
}

button.active{
  background:white;
  color:black;
}

button:active{
  transform:scale(.95);
}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  margin-top:14px;
}

.cell{
  aspect-ratio:1;
  border-radius:16px;
  background:rgba(255,255,255,.15);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:42px;
  transition:.25s;
}

.cell:active{transform:scale(.9)}

.win{
  background:white!important;
  color:black;
}

.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
}

.overlay.show{display:flex}

.modal{
  background:var(--glass);
  backdrop-filter:blur(20px);
  padding:24px;
  border-radius:20px;
  text-align:center;
}
</style>
</head>

<body>

<div class="app">
  <h1>КРЕСТИКИ</h1>

  <!-- ВЫБОР СЛОЖНОСТИ -->
  <div class="menu">
    <button id="d0" onclick="setDiff(0)">Лёгкий</button>
    <button id="d1" onclick="setDiff(1)">Средний</button>
    <button id="d2" onclick="setDiff(2)">Сложный</button>
  </div>

  <button onclick="start()">Начать игру</button>

  <div id="grid" class="grid"></div>
</div>

<div id="overlay" class="overlay">
  <div class="modal">
    <h2 id="result"></h2>
    <button onclick="closeModal()">OK</button>
  </div>
</div>

<script>
/* ===== STATE ===== */
let board = [];
let active = false;
let diff = 0;

const wins = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];

/* ===== DIFFICULTY ===== */
function setDiff(d){
  diff = d;
  document.querySelectorAll('.menu button')
    .forEach(b=>b.classList.remove('active'));
  document.getElementById('d'+d).classList.add('active');
}

/* ===== GAME ===== */
function start(){
  board = Array(9).fill('');
  active = true;
  grid.innerHTML = '';

  for(let i=0;i<9;i++){
    const c=document.createElement('div');
    c.className='cell';
    c.onclick=()=>move(i,c);
    grid.appendChild(c);
  }
}

function move(i,c){
  if(!active || board[i]) return;

  board[i]='X';
  c.textContent='X';

  if(checkWin('X')) return end('Ты победил');
  if(board.every(v=>v)) return end('Ничья');

  setTimeout(aiMove, 350); // ИИ "думает"
}

function aiMove(){
  if(!active) return;

  let move;
  if(diff===0) move=randomMove();
  else if(diff===1) move=smartMove();
  else move=minimaxMove();

  board[move]='O';
  grid.children[move].textContent='O';

  if(checkWin('O')) end('Ты проиграл');
}

/* ===== AI ===== */
function randomMove(){
  return board.map((v,i)=>v==''?i:null).filter(v=>v!=null)
    .sort(()=>Math.random()-0.5)[0];
}

function smartMove(){
  for(let w of wins){
    let e=w.find(i=>board[i]=='');
    if(w.filter(i=>board[i]=='O').length==2 && e!=undefined) return e;
    if(w.filter(i=>board[i]=='X').length==2 && e!=undefined) return e;
  }
  return randomMove();
}

function minimaxMove(){
  return minimax(board,'O').i;
}

function minimax(b,p){
  if(checkState(b,'X')) return {s:-1};
  if(checkState(b,'O')) return {s:1};
  if(b.every(v=>v)) return {s:0};

  let best={s:p=='O'?-2:2};
  for(let i=0;i<9;i++){
    if(!b[i]){
      b[i]=p;
      let r=minimax(b,p=='O'?'X':'O');
      b[i]='';
      r.i=i;
      if((p=='O'&&r.s>best.s)||(p=='X'&&r.s<best.s)) best=r;
    }
  }
  return best;
}

/* ===== CHECKS ===== */
function checkWin(p){
  for(let w of wins)
    if(w.every(i=>board[i]==p)){
      w.forEach(i=>grid.children[i].classList.add('win'));
      return true;
    }
}

function checkState(b,p){
  return wins.some(w=>w.every(i=>b[i]==p));
}

/* ===== END ===== */
function end(t){
  active=false;
  result.textContent=t;
  overlay.classList.add('show');
}

function closeModal(){
  overlay.classList.remove('show');
}
</script>

</body>
</html>